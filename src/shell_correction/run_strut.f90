program run_strut
    use strutinsky
    use constants
    use def_ho, only: betadef
    implicit none

    real(r_kind):: levels(680)
    real(r_kind) :: omega_0, gamma, e_shell_corr
    integer :: A, Z

    gamma = 1
    A = 204
    Z = 82
    omega_0 = 41.0 * A**(-1.0/3.0)
    levels = [  -37.60932,  -36.85630,  -35.83291,  -35.35693,  -34.63992,  -34.59549,  -34.09381,  -33.70419,  -33.32604,  -33.18039,  -31.95714,  -31.89843,  -31.76891,  -31.63552,  -29.84097,  -29.66984,  -29.65315,  -29.45006,  -29.37788,  -28.92810,  -28.39076,  -28.14022,  -27.81508,  -27.46270,  -26.66213,  -26.29381,  -26.29156,  -25.77828,  -25.54403,  -25.44275,  -24.73720,  -24.29661,  -23.68041,  -23.51544,  -23.18351,  -22.89841,  -22.79881,  -22.64109,  -22.33032,  -21.48024,  -20.91844,  -20.68853,  -20.59331,  -20.37311,  -20.09116,  -19.71623,  -19.67618,  -19.12016,  -18.05011,  -18.03296,  -17.94355,  -17.92755,  -17.49778,  -17.36182,  -17.16079,  -16.92512,  -16.75360,  -16.68735,  -16.15328,  -15.46421,  -14.24397,  -14.22323,  -14.08518,  -13.76212,  -13.73660,  -13.13161,  -12.69512,  -12.56244,  -12.40288,  -12.37582,  -12.14451,  -11.82666,  -11.48061,  -11.42932,  -11.38454,  -10.85994,  -10.54618,  -10.35211,  -10.35152,   -9.78454,   -9.38173,   -9.20628,   -9.03908,   -8.65570,   -8.57590,   -7.95299,   -7.64318,   -7.60246,   -7.15877,   -6.95941,   -6.85591,   -6.43458,   -5.95113,   -5.93304,   -5.26893,   -5.13237,   -4.91558,   -4.54601,   -4.35498,   -4.18956,   -4.02570,   -3.99642,   -3.86038,   -3.77825,   -3.77372,   -3.55000,   -2.56979,   -2.50899,   -2.28252,   -2.27020,   -1.78015,   -1.49195,   -1.44291,   -1.30484,   -1.06116,   -0.98265,   -0.88889,   -0.15064,   -0.11710,   -0.08482,    0.24740,    0.44768,    0.52384,    0.57440,    0.70139,    0.95636,    1.58054,    1.60460,    1.81637,    2.18260,    2.76325,    2.96648,    3.08305,    3.16030,    3.31997,    3.32786,    3.41636,    3.93241,    4.10044,    4.37728,    4.38808,    5.09336,    5.16182,    5.21887,    5.32459,    5.51365,    5.90848,    5.92070,    6.59161,    6.66137,    6.81026,    6.89024,    7.12397,    7.23536,    7.51900,    7.54366,    7.56844,    8.08299,    8.10189,    8.24394,    8.31639,    8.61024,    8.70666,    8.80376,    8.82506,    9.11620,    9.35713,    9.40554,    9.49918,    9.71518,   10.01631,   10.19964,   10.26614,   10.32255,   10.43195,   10.64777,   10.88551,   10.91612,   11.05207,   11.14318,   11.27280,   11.40998,   11.44688,   11.45516,   11.77516,   11.87273,   12.04456,   12.08640,   12.36948,   12.41755,   12.77365,   12.88020,   13.17974,   13.21058,   13.25133,   13.38079,   13.38545,   13.46785,   13.77410,   13.85000,   13.89061,   14.21745,   14.25066,   14.26846,   14.59508,   14.73128,   14.77710,   14.91507,   14.93394,   15.13793,   15.14174,   15.26183,   15.39733,   15.47710,   15.56738,   15.61714,   15.62611,   15.84448,   15.93529,   16.06167,   16.29792,   16.35664,   16.35962,   16.40709,   16.52063,   16.83871,   17.02039,   17.06725,   17.08831,   17.10009,   17.28105,   17.33169,   17.64849,   17.72129,   17.73335,   17.79816,   17.85984,   17.94719,   17.99974,   18.07200,   18.11209,   18.30383,   18.51697,   18.68193,   18.68969,   18.93820,   19.00867,   19.01170,   19.04359,   19.24981,   19.29812,   19.43633,   19.61832,   19.62471,   19.66411,   19.74910,   19.79615,   19.90955,   19.96619,   20.05946,   20.08283,   20.11458,   20.26279,   20.28534,   20.32626,   20.39226,   20.47289,   20.54193,   20.55297,   20.58449,   20.64918,   20.74347,   20.83293,   20.87470,   20.93213,   20.97349,   21.10470,   21.12891,   21.13056,   21.14680,   21.21288,   21.27073,   21.27946,   21.31877,   21.66632,   21.81162,   21.87919,   21.96207,   22.14706,   22.23304,   22.25097,   22.36046,   22.41328,   22.60695,   22.72797,   22.75650,   22.77854,   22.90018,   23.08765,   23.09367,   23.12511,   23.23456,   23.27415,   23.54121,   23.54256,   23.63691,   23.70535,   23.75220,   23.79790,   23.83382,   23.88789,   23.97235,   24.05931,   24.21027,   24.23815,   24.28593,   24.36304,   24.48106,   24.52907,   24.53981,   24.63006,   24.63028,   24.86960,   25.00942,   25.07615,   25.10347,   25.11038,   25.13311,   25.22884,   25.24063,   25.24790,   25.40421,   25.51299,   25.67611,   25.86135,   25.86716,   25.96393,   26.02964,   26.03254,   26.15126,   26.17244,   26.21895,   26.24290,   26.25745,   26.32789,   26.39638,   26.49476,   26.52495,   26.66769,   26.95987,   27.09294,   27.12304,   27.30833,   27.31840,   27.38834,   27.41480,   27.43479,   27.57483,   27.59300,   27.60273,   27.67656,   27.69751,   27.80630,   27.83388,   27.87253,   27.94436,   27.99381,   27.99860,   28.10500,   28.11847,   28.15087,   28.19138,   28.21397,   28.32110,   28.36898,   28.42280,   28.59517,   28.62332,   28.72726,   28.77616,   28.83187,   28.84117,   28.95510,   28.97228,   29.05544,   29.05759,   29.06306,   29.07420,   29.15886,   29.34486,   29.36377,   29.41074,   29.43495,   29.48387,   29.54970,   29.59937,   29.62739,   29.80764,   29.89082,   29.89857,   29.97235,   30.02763,   30.16716,   30.19736,   30.32162,   30.37685,   30.49707,   30.52193,   30.59444,   30.71819,   30.78100,   30.89850,   31.06924,   31.16568,   31.18220,   31.26159,   31.38516,   31.41823,   31.70619,   31.77295,   31.79135,   31.93103,   31.94107,   32.00934,   32.11755,   32.20039,   32.23493,   32.36061,   32.38098,   32.42963,   32.55128,   32.56014,   32.65719,   32.70917,   32.79088,   32.91861,   32.92804,   32.93793,   32.96738,   33.04931,   33.06126,   33.09047,   33.26554,   33.38948,   33.49422,   33.59143,   33.61491,   33.61733,   33.66551,   33.70457,   33.96716,   33.96924,   34.03378,   34.32336,   34.34122,   34.35343,   34.40359,   34.49713,   34.49933,   34.59192,   34.65331,   34.78256,   34.79744,   34.88901,   35.11900,   35.18088,   35.22776,   35.27855,   35.28432,   35.33072,   35.35837,   35.36637,   35.37431,   35.60019,   35.86423,   35.92676,   35.93467,   35.95790,   36.00707,   36.02733,   36.13324,   36.15339,   36.27652,   36.37834,   36.46294,   36.59226,   36.61155,   36.64283,   36.66886,   36.67568,   36.86286,   36.87123,   37.08031,   37.20839,   37.25916,   37.32430,   37.40794,   37.47679,   37.50398,   37.65961,   37.69301,   37.78629,   37.85915,   37.95616,   37.97676,   38.00427,   38.05062,   38.07069,   38.07455,   38.07887,   38.10050,   38.18058,   38.19083,   38.29101,   38.34332,   38.36914,   38.51876,   38.62024,   38.69128,   38.72028,   38.86577,   38.93080,   39.09266,   39.09407,   39.10439,   39.15407,   39.22776,   39.25726,   39.36338,   39.46155,   39.64525,   39.73493,   39.83010,   39.86123,   39.94644,   40.00374,   40.13359,   40.35937,   40.42632,   40.48199,   40.49772,   40.57778,   40.71906,   40.73182,   40.73953,   40.74637,   40.77512,   40.86676,   41.06045,   41.13630,   41.15660,   41.35825,   41.37802,   41.44762,   41.57139,   41.68607,   41.84612,   41.97555,   41.98773,   42.14879,   42.72126,   42.95088,   42.97173,   42.98552,   43.16226,   43.20794,   43.35571,   43.61667,   43.66378,   44.00923,   44.12879,   44.30775,   44.43987,   44.58017,   44.71372,   44.92993,   44.93114,   44.97207,   44.99475,   45.03374,   45.10812,   45.12781,   45.17173,   45.46560,   45.67438,   45.73374,   45.78559,   45.83254,   45.92585,   46.09132,   46.12204,   46.13924,   46.16191,   46.23507,   46.26428,   46.34439,   46.42252,   46.63993,   47.15677,   47.24707,   47.29922,   47.32221,   47.33262,   47.52516,   47.69402,   48.04602,   48.13731,   48.23564,   48.32119,   48.55257,   48.59147,   48.76284,   48.82770,   48.92471,   49.09644,   49.24152,   49.87731,   49.89721,   49.94687,   50.05214,   50.20665,   50.27891,   50.70941,   51.15760,   51.31025,   51.48384,   51.52931,   51.63560,   51.96249,   52.09878,   52.11098,   52.11271,   52.53151,   52.58726,   52.59831,   52.92813,   53.10546,   53.34971,   53.48375,   53.84703,   53.87223,   54.04985,   54.43345,   54.77423,   54.82251,   55.11259,   55.22356,   55.28150,   55.28276,   55.29546,   55.36520,   55.42254,   55.42739,   55.55927,   56.08396,   56.42718,   56.64489,   56.81879,   57.12353,   57.30362,   57.64243,   57.89259,   58.36648,   58.42410,   58.79869,   58.89423,   59.24714,   59.35475,   59.95242,   60.02182,   60.03074,   60.06376,   60.14188,   60.19217,   60.68346,   60.73804,   61.05587,   61.15850,   61.23301,   61.25038]!getHOlevels(14, omega_0)
    write(*,'(A,2I4)') "Running shell correction calculation for Z,A=",Z,A
    !e_shell_corr= get_shell(A-Z, levels, omega_0, .false.)
    e_shell_corr = shell_correction(Z, A, betadef(beta2=0.0_r_kind, beta4=0.0_r_kind), .false.)
    write(*,*) "Shell correction energy:", e_shell_corr
    
    contains

    function getHOlevels(N, omega_0)
        integer :: N
        real(r_kind), allocatable :: getHOlevels(:)
        real(r_kind) :: omega_0

        integer :: ii, jj
        integer :: particles
        integer :: numlevels
        
        numlevels = (N+1)*(N+2)*(N+3)/6
        allocate(getHOlevels(numlevels))
        particles = 0
        do ii =0, N
            do jj = 1, (ii+1)*(ii+2)/2
                particles = particles + 1
                getHOlevels(particles) = omega_0 * (ii + 1.5_r_kind)
            end do
        end do
    end function


end program